<!doctype html>
<html lang="en-US"><head>
   <meta charset="utf-8">
    <!-- Chulapa Jekyll Theme - v2.0.1.0001 -->
    <!--  MIT License-->
    <!-- Docs: https://dieghernan.github.io/chulapa -->
    <!-- Repo: https://github.com/dieghernan/chulapa -->
    <!-- Page build 2025-03-10 -->
     <!-- Jekyll Version 4.4.1 -->
    <!--Google Structured Data-->
    <script type="application/ld+json">
        {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://dieghernan.github.io/202312_bertin_dots/"
      },
      "headline": "Beautiful Maps with R (V): Point densities",
      "image": "https://dieghernan.github.io/assets/img/blog/202312_finalmap.webp",
      "datePublished": "2023-12-16T00:00:00+01:00",
      "dateModified": "2023-12-16T00:00:00+01:00",
      "author": {
        "@type": "Person",
        "name": "dieghernan"
        , "url": "https://x.com/dhernangomez"
        ,  "sameAs" : [
             "https://fosstodon.org/@dhernangomez"
            ,
             "https://bsky.app/profile/dieghernan.bsky.social"
            ,
             "https://github.com/dieghernan/"
            ,
             "https://stackoverflow.com/users/7877917/dieghernan"
            ,
             "https://orcid.org/0000-0001-8457-4658"
            ]
      },
       "publisher": {
        "@type": "Organization",
        "name": "dieghernan",
        "url": "https://dieghernan.github.io/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://dieghernan.github.io/assets/img/site/banner.png"
        }
      }
    }
    </script>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Blog",
        "item": "https://dieghernan.github.io/blog/"
      },
    {
        "@type": "ListItem",
        "position": 2,
        "name": "Beautiful Maps with R (V): Point densities"
      }]
    }
    </script>
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "name": "Beautiful Maps with R (V): Point densities",
    "description": "Bertin’s dot density maps with R and GHSL - Another way to represent demographics on a map."
    }
}
</script><script type="application/ld+json">
{
  "@context" : "https://schema.org",
  "@type" : "Person",
  "image": "https://dieghernan.github.io/assets/img/site/avatar.png",
  "homeLocation": {
    "@type": "Place",
    "name": "Madrid, Spain"
    },
  "description": "Publisher",
  "name" : "dieghernan",
  "url" : "https://dieghernan.github.io/"
  ,  "sameAs" : [
  "https://x.com/dhernangomez",
  "https://fosstodon.org/@dhernangomez",
  "https://bsky.app/profile/dieghernan.bsky.social",
  "https://github.com/dieghernan/",
  "https://stackoverflow.com/users/7877917/dieghernan",
  "https://orcid.org/0000-0001-8457-4658"
  ]
}
</script>
   <title>Beautiful Maps with R (V): Point densities | One world</title>
  <link rel="canonical" href="https://dieghernan.github.io/202312_bertin_dots/">
    <!-- Atom feed -->
  <link href="https://dieghernan.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed One world" >
    <!-- RSS 2.0 feed -->
  <link href="https://dieghernan.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="RSS 2.0 feed One world" >
    <!-- Meta tags -->
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="author" content="dieghernan" >
   <meta name="copyright" content="dieghernan" >
   <meta name="description" content="Bertin’s dot density maps with R and GHSL - Another way to represent demographics on a map.">
   <meta name="thumbnail" content="https://dieghernan.github.io/assets/img/blog/202312_finalmap.webp" >
   <meta name="robots" content="index, follow"><meta name="keywords" content="">
    <!-- OpenGraph -->
   <meta property="og:title" content="Beautiful Maps with R (V): Point densities | One world" >
   <meta property="og:site_name" content="One world | Projects, maps and coding" >
   <meta property="og:url" content="https://dieghernan.github.io/202312_bertin_dots/" >
   <meta property="og:type" content="website" >
   <meta property="og:description" content="Bertin’s dot density maps with R and GHSL - Another way to represent demographics on a map." >
   <meta property="og:locale" content="en-US" >
   <meta property="og:image" content="https://dieghernan.github.io/assets/img/blog/202312_finalmap.webp" >
    <!-- Twitter/X Cards -->
   <meta name="twitter:card" content="summary_large_image">
   <meta name="twitter:site" content="@dhernangomez" >
    	<!-- CSS -->
    <!-- Preconnect with Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <!-- Fontawesome-->
    <!-- v6 -->
    <script src="https://kit.fontawesome.com/afe0d1dec9.js" crossorigin="anonymous"></script>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/js/chulapa_script.js" as="script" >
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/fonts/Chulapa/Chulapa-Bold_vmod.otf" as="font" type="font/otf" crossorigin>
    <!-- Theme css (Bootstrap included) -->
  <link rel="stylesheet" id="maincss" href="https://dieghernan.github.io/assets/css/main.css" >
    <!-- Highlighter -->
  <link id="csshigh" rel="stylesheet" href="https://dieghernan.github.io/assets/css/highlighter.css" >
    <!-- Custom css -->
  <link rel="stylesheet" href="https://dieghernan.github.io/assets/css/custom.css" >
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FWXW2HLTVZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FWXW2HLTVZ');
</script>
<!-- start custom head snippets -->
<link rel="webmention" href="https://webmention.io/dieghernan.github.io/webmention" />
<link rel="pingback" href="https://webmention.io/dieghernan.github.io/xmlrpc" />
<meta name="msvalidate.01" content="6AB8513679757EDD8E6978F8E8BC2508" />
<meta name="fediverse:creator" content="@dhernangomez@fosstodon.org">
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#000000">
<!-- end custom head snippets --></head>
<body class="d-flex flex-column h-entry" id="body">
	<a class="u-url d-none" href="https://dieghernan.github.io/202312_bertin_dots/">Invisible link to canonical for Microformats</a>
	<nav class="navbar navbar-expand-xl sticky-top navbar-chulapa" aria-label="primary-navigation">
	<div class="container-fluid mx-md-2">
			<a class="navbar-brand font-weight-bold" href="https://dieghernan.github.io/"><img src="https://dieghernan.github.io/assets/img/favicons/android-chrome-72x72.png" width="30" height="30" class="d-inline-block align-top rounded-lg mr-1" alt="NavbarLogo">Home</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarToggler">
				<ul class="navbar-nav ml-auto"><li class="nav-item">
						<a class="nav-link " href="https://dieghernan.github.io/blog/">Blog</a>
					</li><li class="nav-item">
						<a class="nav-link " href="https://dieghernan.github.io/projects">Projects</a>
					</li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle " href="#" id="Archives" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Archives</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Archives"><a class="dropdown-item " href="https://dieghernan.github.io/archive">By date</a><a class="dropdown-item " href="https://dieghernan.github.io/tags">By tags</a></div>
					</li><li class="nav-item">
						<a class="nav-link " href="https://dieghernan.github.io/gallery">Gallery</a>
					</li><li class="nav-item">
						<a class="nav-link " href="https://github.com/dieghernan/dieghernan.github.io"><i class="fab fa-github" aria-hidden="true"></i> GitHub repo</a>
					</li><li class="nav-item">
						<a class="nav-link " href="https://www.r-bloggers.com/"><i class="fas fa-external-link-alt" aria-hidden="true"></i> R-bloggers</a>
					</li><li class="nav-item">
						<a class="nav-link " href="https://dieghernan.github.io/search">
							<span class="d-md-none p-0 pr-1">Search</span><i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search</span>
						</a>
					</li></ul>
			</div></div>
</nav>	<header class="header-chulapa"><div class="container-fluid header-chulapa-img w-100" style="background-image: url('https://dieghernan.github.io/assets/img/blog/202312_finalmap.webp')">
     </div><div class="container-lg mt-2">
       <div class="row">
           <div class="col-lg-8 offset-lg-2">
           <h1 class="p-name">Beautiful Maps with R (V): Point densities</h1><p class="lead chulapa-subtitle p-summary">Bertin’s dot density maps with R and GHSL</p>
           <hr class="mb-0">
			</div>
		</div>
	</div>
</header>
	<main class="container-lg pb-3 flex-fill">
<div class="row my-1">
<div class="col-lg-5 offset-lg-2 col small">
 <nav aria-label="breadcrumb">
  <ol class="breadcrumb my-0 py-0 chulapa-bg-transparent pl-0" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb-item" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem"><a href="https://dieghernan.github.io/blog/" itemprop="item"><span itemprop="name">Blog</span></a>
         <meta itemprop="position" content="1" ></li>
      <li class="breadcrumb-item active" aria-current="page" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem">
        <span itemprop="name">Beautiful Maps with R (V): Point densities</span>
       <meta itemprop="position" content="2" >
     </li>
 </ol>
 </nav>
 <div class="chulapaDateSocial">
            <time datetime="2023-12-16T00:00:00+01:00" class="dt-published" >16 dec 2023</time>
        </div></div>
         <div class="col-lg-3 col-sm-4 col-3 text-right lead chulapaDateSocial">
            <a  href="https://twitter.com/intent/tweet?url=https://dieghernan.github.io/202312_bertin_dots/&text=Beautiful+Maps+with+R+%28V%29%3A+Point+densities&via=dhernangomez&hashtags=r_bloggers,beautiful_maps,rstats,rspatial,maps,ggplot2,sf,terra,tidyterra,giscoR" title="Share on X" aria-label="Share on X" ><i class="fab fa-square-x-twitter fa-lg" aria-hidden="true"></i></a>
            <a href="https://bsky.app/intent/compose?text=Beautiful%20Maps%20with%20R%20(V):%20Point%20densities%20https://dieghernan.github.io/202312_bertin_dots/%20%23r_bloggers%20%23beautiful_maps%20%23rstats%20%23rspatial%20%23maps%20%23ggplot2%20%23sf%20%23terra%20%23tidyterra%20%23giscoR" title="Share on Bluesky" aria-label="Share on Bluesky"><i class="fa-brands fa-square-bluesky fa-lg" aria-hidden="true"></i></a>
            <a  class="d-none d-sm-inline" href="https://www.facebook.com/sharer.php?u=https://dieghernan.github.io/202312_bertin_dots/" title="Share on Facebook" aria-label="Share on Facebook" ><i class="fab fa-facebook-square fa-lg" aria-hidden="true"></i></a>
             <a  class="d-none d-sm-inline" href="https://api.whatsapp.com/send?&text=Beautiful+Maps+with+R+%28V%29%3A+Point+densities%20https://dieghernan.github.io/202312_bertin_dots/" title="Share on Whatsapp" aria-label="Share on Whatsapp" ><i class="fab fa-whatsapp-square fa-lg" aria-hidden="true"></i></a>
         <a  class="d-none d-sm-inline" href="https://www.linkedin.com/shareArticle?url=https://dieghernan.github.io/202312_bertin_dots/&title=Beautiful+Maps+with+R+%28V%29%3A+Point+densities" title="Share on LinkedIn" aria-label="Share on LinkedIn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
         </div></div>
		<div class="row pt-2">
			<aside class="col-lg-2 mt-lg-3 small"><div rel="author" class="h-card p-author">
				<div class="row d-flex align-items-center mb-2"><img src="https://dieghernan.github.io/assets/img/site/avatar.png" alt="dieghernan" class="ml-3 mr-0 mx-lg-auto mb-lg-1 chulapa-avatar-size u-photo"><div class="col-9 col-lg-12 text-lg-center p-name">
						dieghernan
					</div>
				</div>
				<div class="row mb-2 mb-lg-0">
					<div class="col text-lg-center"><address class="d-inline d-lg-block mr-2 mx-lg-auto mb-lg-2 small chulapa-links-hover-only">
						  <a class="pr-lg-0 p-region" href="https://www.google.com/maps/search/?api=1&query=Madrid%2C+Spain">
						    <i class="fas fa-map-marker-alt fa-lg mr-1" aria-hidden="true"></i>Madrid, Spain</a>
						</address><div class="d-inline my-1 mx-lg-0 chulapa-links-hover-only"><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://x.com/dhernangomez" title="My Twitter/X" aria-label="My Twitter/X" ><i class="fab fa-square-x-twitter fa-lg" aria-hidden="true"></i></a><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://fosstodon.org/@dhernangomez" title="My Mastodon" aria-label="My Mastodon" ><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></a><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://bsky.app/profile/dieghernan.bsky.social" title="My Bluesky" aria-label="My Bluesky" ><i class="fa-brands fa-square-bluesky fa-lg" aria-hidden="true"></i></a><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://github.com/dieghernan/" title="My GitHub" aria-label="My GitHub" ><i class="fab fa-github fa-lg" aria-hidden="true"></i></a><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://stackoverflow.com/users/7877917/dieghernan" title="On StackOverflow" aria-label="On StackOverflow" ><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a><a class="mr-2 mx-lg-1 u-url" rel="me" href="https://orcid.org/0000-0001-8457-4658" title="My Orcid" aria-label="My Orcid" ><i class="fa-brands fa-orcid fa-lg" aria-hidden="true"></i></a></div></div>
				</div>
				</div>
</aside>
			<article id="maincontent" class="col-lg-8 mt-3 e-content">
	<button class="btn btn-primary btn-sm rounded-right position-fixed chulapa-btn-sidebar bs-canvas-anim chulapa-btn-nofocus chulapa-fa-static" id='demo' onclick="openSideBar()" aria-label="Open Sidebar" aria-expanded="false" aria-controls="sideBar">
		<i class="fa-solid fa-plus"></i><span class="sr-only">Open Sidebar</span>
	</button>
	<div class="bs-canvas bs-canvas-anim bs-canvas-left position-fixed navbar-chulapa h-100" id='sideBar'>
		<p class="pt-2 pb-1 px-3">
			<button type="button" class="navbar-text close chulapa-btn-nofocus chulapa-fa-static" aria-label="Close" onclick="closeSideBar()">
				<i class="fa-solid fa-times"></i><span class="sr-only">Close Sidebar</span>
			</button>
		</p>
		<nav class="navbar-nav px-3 my-auto">		  <p class="mb-2" ><a class="nav-link font-weight-bold lead" href="#">Beautiful Maps with R (V): Point densities</a></p>		
			<ul class="nav flex-column" id="sidetoc"><li class="nav-item nav d-block"><a href="#libraries" class="nav-link">Libraries</a></li><li class="nav-item nav d-block"><a href="#get-the-data" class="nav-link">Get the data</a></li><li class="nav-item nav d-block"><a href="#data-wrangling" class="nav-link">Data wrangling</a></li><li class="nav-item nav d-block"><a href="#final-plot" class="nav-link">Final plot</a></li><li class="nav-item nav d-block"><a href="#alternative-hexagonal-grid" class="nav-link">Alternative hexagonal grid</a></li><li class="nav-item nav d-block"><a href="#references" class="nav-link">References</a></li></ul>
		</nav>   
	</div>
			<p>Recently the <a href="https://r-graph-gallery.com/">R Graph Gallery</a> has incorporated a
new post by <a href="https://twitter.com/BjnNowak">Benjamin Nowak</a> showing how to create
a dot density map based on the work of the french cartographer <a href="https://en.wikipedia.org/wiki/Jacques_Bertin">Jacques
Bertin</a> (1918 - 2010):</p>
<p><img src="https://dieghernan.github.io/assets/img/misc/bertin.png" alt="Jacques Bertin, Sémiologie graphique. Les diagrammes. Les réseaux. Les cartes
(1967)" /></p>
<p>In this post I would create a similar map for Iberia, and additionally I would
show how to create a variation using a hexagonal grid instead of a rectangular
one. This is the first issue of the series 
<a href="https://dieghernan.github.io/tags#beautiful_maps">Beautiful Maps with R</a>.</p>
<h2 id="libraries">Libraries</h2>
<p>I would use the following libraries for loading, manipulating and plotting
spatial data (both raster and vector):</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Base spatial packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="c1"># Spatial data</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">giscoR</span><span class="p">)</span><span class="w">
</span><span class="c1"># Wrangling and plotting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyterra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggtext</span><span class="p">)</span><span class="w">
</span><span class="c1"># Additional for hex grids</span><span class="w">
</span><span class="c1"># Supporting for units and bridge raster to polygon</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">exactextractr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h2 id="get-the-data">Get the data</h2>
<p>The first step is always to get the data we need. My final map would use as a
base a circular layout with Iberia in the middle (that would be our observation
window), so we can get the corresponding shapes and create a buffer around it.</p>
<p>After that, we would extract the population spatial distribution from <a href="https://ghsl.jrc.ec.europa.eu/download.php">GHSL -
Global Human Settlement Layer</a>. We
would use the global file with a resolution of 1 km on Mollweide projection
(ESRI:54009).</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create observation window based the Iberian Peninsula and surroundings</span><span class="w">
</span><span class="c1"># We create a buffered circle</span><span class="w">
</span><span class="n">owin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gisco_get_countries</span><span class="p">(</span><span class="w">
  </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ES"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PT"</span><span class="p">),</span><span class="w">
  </span><span class="c1"># We buffer in 3035 since I want my final map on this projection</span><span class="w">
  </span><span class="n">epsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3035</span><span class="p">,</span><span class="w">
  </span><span class="n">resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_union</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">of_largest_polygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_buffer</span><span class="p">(</span><span class="m">750000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># But for extracting raster data we need this in Mollweide so far</span><span class="w">
  </span><span class="n">st_transform</span><span class="p">(</span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ESRI:54009"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get additional shapes and cut them to the owin</span><span class="w">
</span><span class="n">regions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gisco_get_nuts</span><span class="p">(</span><span class="n">resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">nuts_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_transform</span><span class="p">(</span><span class="n">st_crs</span><span class="p">(</span><span class="n">owin</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_intersection</span><span class="p">(</span><span class="n">owin</span><span class="p">)</span><span class="w">

</span><span class="n">countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gisco_get_countries</span><span class="p">(</span><span class="n">resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_transform</span><span class="p">(</span><span class="n">st_crs</span><span class="p">(</span><span class="n">owin</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_intersection</span><span class="p">(</span><span class="n">owin</span><span class="p">)</span><span class="w">

</span><span class="c1"># Base map</span><span class="w">
</span><span class="n">base_gg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regions</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countries</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owin</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w">

</span><span class="n">base_gg</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://dieghernan.github.io/assets/img/blog/202312_basemap-1.webp" alt="plot of chunk 202312_basemap" /></p>
<p>That would be our base map. Now we download programmatically the GHSL data and
we would check that everything is correct. At this point, it is interesting to
use the <code class="language-plaintext highlighter-rouge">win</code> argument when reading the raster with <code class="language-plaintext highlighter-rouge">terra::rast()</code>, as this
would allow us to load only the desired area with the subsequent improvement in
terms of performance.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Download data</span><span class="w">
</span><span class="c1"># We need the following file (download 305Mb)</span><span class="w">
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/GHSL/GHS_POP_GLOBE_R2023A/GHS_POP_E2030_GLOBE_R2023A_54009_1000/V1-0/GHS_POP_E2030_GLOBE_R2023A_54009_1000_V1_0.zip"</span><span class="w">

</span><span class="c1"># This is where I would store the file, you would need to modify the folder</span><span class="w">
</span><span class="n">fname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"~/R/mapslib/GHS"</span><span class="p">,</span><span class="w"> </span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">))</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">fname</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">zip_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unzip</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">zip_content</span><span class="w">
</span><span class="c1">#&gt;                                                 Name    Length                Date</span><span class="w">
</span><span class="c1">#&gt; 1     GHS_POP_E2030_GLOBE_R2023A_54009_1000_V1_0.tif 263188307 2023-04-28 21:11:00</span><span class="w">
</span><span class="c1">#&gt; 2 GHS_POP_E2030_GLOBE_R2023A_54009_1000_V1_0.tif.ovr  88461532 2023-04-28 21:11:00</span><span class="w">
</span><span class="c1">#&gt; 3                         GHSL_Data_Package_2023.pdf   9761851 2023-10-27 14:30:00</span><span class="w">
</span><span class="c1">#&gt; 4           GHS_POP_GLOBE_R2023A_input_metadata.xlsx    137963 2023-04-30 10:42:00</span><span class="w">

</span><span class="c1"># Unzip</span><span class="w">
</span><span class="n">unzip</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="n">exdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"~/R/mapslib/GHS"</span><span class="p">,</span><span class="w"> </span><span class="n">junkpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create the path to the file</span><span class="w">
</span><span class="n">global_tiff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zip_content</span><span class="o">$</span><span class="n">Name</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"tif$"</span><span class="p">,</span><span class="w"> </span><span class="n">zip_content</span><span class="o">$</span><span class="n">Name</span><span class="p">)]</span><span class="w">
</span><span class="n">global_tiff_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"~/R/mapslib/GHS"</span><span class="p">,</span><span class="w"> </span><span class="n">global_tiff</span><span class="p">)</span><span class="w">

</span><span class="c1"># And read cropping to our owin</span><span class="w">
</span><span class="n">pop_init</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rast</span><span class="p">(</span><span class="n">global_tiff_path</span><span class="p">,</span><span class="w"> </span><span class="n">win</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as_spatvector</span><span class="p">(</span><span class="n">owin</span><span class="p">))</span><span class="w">

</span><span class="c1"># Consistent naming of the layer</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">pop_init</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"population"</span><span class="w">

</span><span class="n">ncell</span><span class="p">(</span><span class="n">pop_init</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 2255923</span><span class="w">

</span><span class="c1"># And check with tidyterra</span><span class="w">
</span><span class="n">base_gg</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_init</span><span class="p">,</span><span class="w"> </span><span class="n">maxcell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_viridis_c</span><span class="p">(</span><span class="n">na.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"transparent"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://dieghernan.github.io/assets/img/blog/202312_base_raster-1.webp" alt="plot of chunk 202312_base_raster-1" /></p>
<h2 id="data-wrangling">Data wrangling</h2>
<p>The GHSL information contains the estimated population on each grid. However the
file has a high resolution (more than 2 millions of cells) so for plotting
purposes we are going to reduce (i.e. aggregate) the number of cells so we can
have a better dot visualization. Once that we aggregate, we would compute the
area of each new aggregated cell and compute the corresponding population
density.</p>
<p>Instead of using the numeric range of densities, we would use categories for the
final map, so we would classify the density into different groups:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Reduce resolution for visualization</span><span class="w">
</span><span class="c1"># Compute factor to reduce raster to (aprox) 100 rows:</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">pop_init</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1511</span><span class="w">
</span><span class="n">factor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">pop_init</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="c1"># Each new cell would contain the sum of population of the aggregated cells</span><span class="w">
</span><span class="n">pop_agg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pop_init</span><span class="p">,</span><span class="w">
  </span><span class="n">fact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w">
  </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="p">)</span><span class="w">


</span><span class="c1"># Compute area of each new cell</span><span class="w">
</span><span class="n">pop_agg</span><span class="o">$</span><span class="n">area_km2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cellSize</span><span class="p">(</span><span class="n">pop_agg</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"km"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Compute densities, mask to owin, convert to points and create categories</span><span class="w">
</span><span class="n">pop_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pop_agg</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Compute density by cell</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">dens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">population</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">area_km2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Mask to the countries shapes</span><span class="w">
  </span><span class="n">mask</span><span class="p">(</span><span class="n">as_spatvector</span><span class="p">(</span><span class="n">countries</span><span class="p">),</span><span class="w"> </span><span class="n">touches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># SpatVector as points</span><span class="w">
  </span><span class="n">as.points</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Categorize</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">250</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1500</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
    </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"G"</span><span class="w">
  </span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<h2 id="final-plot">Final plot</h2>
<p>And finally the map. In this case I would save it as a high resolution square
map.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Final plot</span><span class="w">
</span><span class="n">final_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">base_gg</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># Layer, this object is a SpatVector instead of sf object</span><span class="w">
  </span><span class="n">geom_spatvector</span><span class="p">(</span><span class="w">
    </span><span class="n">pop_points</span><span class="p">,</span><span class="w">
    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cat</span><span class="p">),</span><span class="w">
    </span><span class="c1"># Use a point with a border AND a fill</span><span class="w">
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_size_manual</span><span class="p">(</span><span class="w">
    </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="m">3.5</span><span class="p">),</span><span class="w">
    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
      </span><span class="s2">"&lt; 25"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[25, 50)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[50, 100)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[100, 250)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"[250, 500)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[500, 1500)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"≥ 1500"</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="w">
      </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
      </span><span class="n">title.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w">
      </span><span class="n">keywidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
      </span><span class="n">label.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"**Population density in Iberia**"</span><span class="p">,</span><span class="w">
    </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"in the way of Jacques Bertin"</span><span class="p">,</span><span class="w">
    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;span style='color:grey'&gt;Inhabitants per km&lt;sup&gt;2&lt;/sup&gt;&lt;/span&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"**Data** GHSL **| Plot** @dhernangomez based on @BjnNowak"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_void</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># This CRS for representation only</span><span class="w">
  </span><span class="n">coord_sf</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3035</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="c1"># plot.margin = margin(20,0,20,0,"cm"),</span><span class="w">
    </span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">
    </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w">
    </span><span class="n">legend.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(),</span><span class="w">
    </span><span class="n">legend.key.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey40"</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(</span><span class="w">
      </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w">
      </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
      </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">



</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"202312_finalmap.png"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://dieghernan.github.io/assets/img/blog/202312_finalmap.webp" alt="plot of chunk 202312_base_raster-1" /></p>
<h2 id="alternative-hexagonal-grid">Alternative hexagonal grid</h2>
<p>The previous plot is based on the centroids of each cell of the raster, that is,
by definition, a rectangular grid. I would like also to experiment with
hexagonal grids (i.e. grid of hexagons) since I have the feeling that looks more
“natural” than the rectangular ones, that presents a regularity hardly seen in
the wild.</p>
<p>The issue here is that <code class="language-plaintext highlighter-rouge">terra</code> does not produce this type of grids, however it
is possible to create them with <code class="language-plaintext highlighter-rouge">sf::st_make_grid()</code>, so the workflow for this
altenative is:</p>
<ol>
 <li>Create a hexagonal grid, where each hexagon represents a similar area than
each cell on the aggregated raster.</li>
 <li>Extract the values of the raster to the new grid.</li>
 <li>Finally, follow the same steps on data wrangling and plotting.</li>
</ol>
<p>When working with <code class="language-plaintext highlighter-rouge">sf::st_make_grid(square = FALSE)</code>, the parameter <code class="language-plaintext highlighter-rouge">cellsize</code>
should be the “diameter” of the hexagon instead of the area. Luckly, we can
infer this value since the area of a hexagon is</p>
\[A = \frac{\sqrt{3}}{2}d^{2}\]
<p>So we can extract \(d\) from the previous expression knowing the area \(A\) of
the aggregated cells:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Hex grid with sf ----</span><span class="w">

</span><span class="c1"># Avg size of the cells on the aggregated grid</span><span class="w">
</span><span class="n">target_area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cellSize</span><span class="p">(</span><span class="n">pop_agg</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"km"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pull</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mean</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as_units</span><span class="p">(</span><span class="s2">"km^2"</span><span class="p">)</span><span class="w">

</span><span class="n">target_area</span><span class="w">
</span><span class="c1">#&gt; 224.7461 [km^2]</span><span class="w">

</span><span class="c1"># Infer diam hex</span><span class="w">
</span><span class="n">diam_hex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_area</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="c1"># Create hexagonal grid</span><span class="w">
</span><span class="n">pop_agg_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="n">owin</span><span class="p">,</span><span class="w"> </span><span class="n">cellsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diam_hex</span><span class="p">,</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="nf">length</span><span class="p">(</span><span class="n">pop_agg_sf</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 10340</span><span class="w">
</span><span class="n">ncell</span><span class="p">(</span><span class="n">pop_agg</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 10100</span><span class="w">

</span><span class="n">area_km2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_area</span><span class="p">(</span><span class="n">pop_agg_sf</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">set_units</span><span class="p">(</span><span class="s2">"km^2"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="nf">as.double</span><span class="p">()</span><span class="w">

</span><span class="n">pop_agg_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">area_km2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">area_km2</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_agg_sf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Now, we use <code class="language-plaintext highlighter-rouge">exact_extract()</code> to extract the population on each hexagonal grid.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Extract aggregated population by hex cell</span><span class="w">
</span><span class="n">pop_agg_sf</span><span class="o">$</span><span class="n">population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">exact_extract</span><span class="p">(</span><span class="n">pop_init</span><span class="p">,</span><span class="w">
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_agg_sf</span><span class="p">,</span><span class="w">
  </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
  </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sum"</span><span class="w">
</span><span class="p">)</span><span class="w">


</span><span class="n">base_gg</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="w">
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_agg_sf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">population</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w">
    </span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">population</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_viridis_c</span><span class="p">(</span><span class="n">na.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"transparent"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://dieghernan.github.io/assets/img/blog/202312_hexgrid_base-1.webp" alt="plot of chunk 202312_base_raster-1" /></p>
<p>Finally we just compute densities, create categories and finally the map:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Mask and categorize</span><span class="w">
</span><span class="n">pop_sf_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pop_agg_sf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Compute density by cell</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">dens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">population</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">area_km2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># To points and filter to country shape</span><span class="w">
  </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">of_largest_polygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_filter</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Categorize</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">250</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w">
    </span><span class="n">dens</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1500</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
    </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"G"</span><span class="w">
  </span><span class="p">))</span><span class="w">

</span><span class="c1"># Final plot</span><span class="w">
</span><span class="n">final_plot_hex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">base_gg</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># Layer, this object is a sf object</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="w">
    </span><span class="n">pop_sf_points</span><span class="p">,</span><span class="w">
    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cat</span><span class="p">),</span><span class="w">
    </span><span class="c1"># Use a point with a border AND a fill</span><span class="w">
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_size_manual</span><span class="p">(</span><span class="w">
    </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="m">3.5</span><span class="p">),</span><span class="w">
    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
      </span><span class="s2">"&lt; 25"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[25, 50)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[50, 100)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[100, 250)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"[250, 500)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"[500, 1500)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"≥ 1500"</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="w">
      </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
      </span><span class="n">title.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w">
      </span><span class="n">keywidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
      </span><span class="n">label.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"**Population density in Iberia**"</span><span class="p">,</span><span class="w">
    </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"in the way of Jacques Bertin"</span><span class="p">,</span><span class="w">
    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;span style='color:grey'&gt;Inhabitants per km&lt;sup&gt;2&lt;/sup&gt;&lt;/span&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"**Data** GHSL **| Plot** @dhernangomez based on @BjnNowak"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_void</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># This CRS for representation only</span><span class="w">
  </span><span class="n">coord_sf</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3035</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="c1"># plot.margin = margin(20,0,20,0,"cm"),</span><span class="w">
    </span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">
    </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w">
    </span><span class="n">legend.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(),</span><span class="w">
    </span><span class="n">legend.key.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey40"</span><span class="p">),</span><span class="w">
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_markdown</span><span class="p">(</span><span class="w">
      </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w">
      </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w">
      </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"202312_finalmap_hex.png"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://dieghernan.github.io/assets/img/blog/202312_finalmap_hex.webp" alt="plot of chunk 202312_finalmap_hex" /></p>
<p>And that’s it! Which one do you like the most? Let me know in the comments.</p>
<h2 id="references">References</h2>
<ul>
 <li>Bertin J (1967). <em>Sémiologie graphique. Les diagrammes. Les réseaux. Les
cartes</em>. Gauthier-Villars, Paris.</li>
 <li>European Commission. Joint Research Centre. (2023). <em>GHSL data package
2023.</em>. Publications Office, LU <a href="https://doi.org/10.2760/098587">https://doi.org/10.2760/098587</a></li>
 <li>Hernangómez D (2023). “Using the tidyverse with terra objects: the tidyterra
package <em>Journal of Open Source Software</em>, <em>8</em>(91), 5751. ISSN 2475-9066
<a href="https://doi.org/10.21105/joss.05751">https://doi.org/10.21105/joss.05751</a></li>
 <li>Pesaresi M, Politis P (2023). “GHS-BUILT-C R2023A - GHS Settlement
Characteristics, derived from Sentinel2 composite (2018) and other GHS
R2023A data.” <a href="https://doi.org/10.2905/3C60DDF6-0586-4190-854B-F6AA0EDC2A30">https://doi.org/10.2905/3C60DDF6-0586-4190-854B-F6AA0EDC2A30</a></li>
</ul>
			<div class="mt-5 pt-3 mb-3 text-center">
			<script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support Me on Ko-fi', '#000000', 'K3K43H86Z');kofiwidget2.draw();</script> 
			</div>
			</article>
		</div>
	</main><nav aria-label="Navigation" class="container-lg chulapa-pagination  ">
 <ul class="col-lg-8 offset-lg-2 pagination chulapa-pagination-round px-0 ">
   <li class="page-item text-left mr-0 ">
      <a class="page-link border-0 px-4" href="https://dieghernan.github.io/202301_star-map-R/" tabindex="-1">
	  <i class="fa fa-chevron-left" aria-hidden="true"></i><span class="sr-only">Previous</span>
	  </a>
   </li>
   <li class="page-item border-0 disabled text-left ml-0 mr-auto d-none d-md-inline ">
     <p class="page-link chulapa-label">Star Map with R</p>
   </li>
   <li class="page-item border-0 disabled text-left ml-0 mr-auto d-none d-sm-inline d-md-none ">
     <p class="page-link chulapa-label">Star Map with R</p>
   </li>
	 <li class="page-item disabled mx-auto invisible">
	  <p class="page-link">|</p>
	 </li>	
	 <li class="page-item border-0 disabled text-right mr-0 ml-auto d-none d-sm-inline d-md-none ">
	   <p class="page-link chulapa-label">Optimize your ...</p>
	 </li>
	 <li class="page-item border-0 disabled text-right mr-0 ml-auto d-none d-md-inline ">
	   <p class="page-link chulapa-label">Optimize your images with R...</p>
	 </li>
   <li class="page-item text-right ml-0 ">
      <a class="page-link border-0 px-4" href="https://dieghernan.github.io/202402_optimize-images-r/">
	  <i class="fa fa-chevron-right" aria-hidden="true"></i><span class="sr-only">Next</span></a>
   </li>
 </ul>
</nav>
<div class="container-lg my-1">
 <div class="row">
   <div class="col-lg-8 offset-lg-2 col">
      <i class="fas fa-tag mr-1 fa-xs" aria-hidden="true"></i>
      <a href="https://dieghernan.github.io/tags#r_bloggers" class="badge chulapa-pill-bg-primary p-category" rel="tag" >r_bloggers</a>
      <a href="https://dieghernan.github.io/tags#beautiful_maps" class="badge chulapa-pill-bg-primary p-category" rel="tag" >beautiful_maps</a>
      <a href="https://dieghernan.github.io/tags#rstats" class="badge chulapa-pill-bg-primary p-category" rel="tag" >rstats</a>
      <a href="https://dieghernan.github.io/tags#rspatial" class="badge chulapa-pill-bg-primary p-category" rel="tag" >rspatial</a>
      <a href="https://dieghernan.github.io/tags#maps" class="badge chulapa-pill-bg-primary p-category" rel="tag" >maps</a>
      <a href="https://dieghernan.github.io/tags#ggplot2" class="badge chulapa-pill-bg-primary p-category" rel="tag" >ggplot2</a>
      <a href="https://dieghernan.github.io/tags#sf" class="badge chulapa-pill-bg-primary p-category" rel="tag" >sf</a>
      <a href="https://dieghernan.github.io/tags#terra" class="badge chulapa-pill-bg-primary p-category" rel="tag" >terra</a>
      <a href="https://dieghernan.github.io/tags#tidyterra" class="badge chulapa-pill-bg-primary p-category" rel="tag" >tidyterra</a>
      <a href="https://dieghernan.github.io/tags#giscoR" class="badge chulapa-pill-bg-primary p-category" rel="tag" >giscoR</a>
     </div>
   </div>
</div>
<!-- Compatible with Jekyll v3 and v4, pure Jekyll group by -->
       <div class="container-lg mt-1 mb-2">
         <div class="row">
           <div class="col-lg-8 offset-lg-2">
             <hr>
             <p><i class="fa-solid fa-shuffle fa-xl"></i><span class="sr-only">Related</span></p>
             <nav class="card-group" aria-label="related-articles"><div class="card  border chulapa-related">
       <div class="card-body">
         <p class="card-title chulapa-headingfont">
            <a href="https://dieghernan.github.io/202502_st_valentine/" class="chulapa-text-body-color">
              Happy Valentine’s Day
            </a>
         </p>
           <p class="card-text">
              <small>Do you know the Bonne projection?</small>
           </p></div>
       <div class="card-footer bg-transparent">
            <small>
              <i class="far fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-02-17T00:00:00+01:00">
                february 17, 2025
              </time>
            </small>
       </div>
     </div>
     <div class="card ml-sm-1 border chulapa-related">
       <div class="card-body">
         <p class="card-title chulapa-headingfont">
            <a href="https://dieghernan.github.io/202212_tidyterra-hillshade-2/" class="chulapa-text-body-color">
              Hillshade, colors and marginal plots with tidyterra (II)
            </a>
         </p>
           <p class="card-text">
              <small>The rain in Spain does not stay mainly in the plain</small>
           </p></div>
       <div class="card-footer bg-transparent">
            <small>
              <i class="far fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-12-12T00:00:00+01:00">
                december 12, 2022
              </time>
            </small>
       </div>
     </div>
     <div class="card ml-sm-1 border chulapa-related">
       <div class="card-body">
         <p class="card-title chulapa-headingfont">
            <a href="https://dieghernan.github.io/202210_tidyterra-hillshade/" class="chulapa-text-body-color">
              Hillshade, colors and marginal plots with tidyterra (I)
            </a>
         </p>
           <p class="card-text">
              <small>How to overlay SpatRasters</small>
           </p></div>
       <div class="card-footer bg-transparent">
            <small>
              <i class="far fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-10-17T00:00:00+02:00">
                october 17, 2022
              </time>
            </small>
       </div>
     </div></nav>
           </div>
         </div>
       </div><!-- Footer -->
 <footer class="footer-chulapa text-center mt-0 pt-3">
   <div class="container">
         <div class="row">
           <div class="col-lg-8 offset-lg-2">
         <script src="https://giscus.app/client.js"
        data-repo="dieghernan/dieghernan.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyODMxNzgwNTA="
        data-category="Blog"
        data-category-id="DIC_kwDOEOD0Qs4CcqYn"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="dark_high_contrast"
        data-lang="es"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
           </div>
        </div>
      </div>
   <div class="container">
     <div class="row">
       <div class="col-xl-10 offset-xl-1"><div role="navigation" class="d-flex flex-wrap justify-content-center"><a href="https://dieghernan.github.io/atom.xml" title="footerRSS" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RSS</span>
            </a><a href="https://stackoverflow.com/users/7877917/dieghernan" title="footerStack Overflow" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Stack Overflow</span>
            </a><a href="https://commons.wikimedia.org/wiki/Special:ListFiles?limit=50&user=dieghernan84" title="footerWikiCommons" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-wikipedia-w fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">WikiCommons</span>
            </a><a href="https://github.com/dieghernan/" title="footerGitHub" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">GitHub</span>
            </a><a href="https://rpubs.com/dieghernan" title="footerRPubs" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-r-project fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RPubs</span>
            </a></div><p class="mt-2 mb-3">&copy; 2025 dieghernan</p>
          <!-- Do not remove this in order to give  attributions -->
         <p class="chulapa-footer-brand">Powered by <a href="https://dieghernan.github.io/chulapa"> <span class="chulapa">Chulapa</span> Jekyll Theme</a><br><b>GitDev</b> skin by <a href="https://github.com/dieghernan">dieghernan</a></p>
          <!-- End  attributions -->
       </div>
     </div>
 </div>
</footer>
<!-- Footer -->
<!-- JS, Popper.js, and jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/js/chulapa_script.js"></script>
	<!-- start custom scripts to be placed at the bottom of the page -->
<script>
for (const a of document.querySelectorAll(".badge")) {
    if (a.textContent.match("discontinued")) {
        a.classList.add("bg-danger");
    }
}
for (const a of document.querySelectorAll(".btn")) {
    if (a.textContent.match("discontinued")) {
        a.classList.add("bg-danger");
        a.classList.add("border-danger");
    }
}
for (const a of document.querySelectorAll("h5")) {
    if (a.textContent.match("discontinued")) {
        a.classList.add("text-danger");
    }
}
</script>
<!-- end custom bottom scripts -->
	</body>
</html>
